ORG 0000H
AJMP INITIAL
ORG 0003H                ; 使用INT0中斷
JMP INTERRUPT
ORG 0050H
INITIAL:
    SETB IT0             ; 將INT0的觸發條件設為falling edge
    MOV IP,#00000001B    ; 將INT0的優先度設為high,其他設為low
    MOV IE,#10000001B    ; 啟用INT0
    MOV R2,#0            ; 紀錄晃動次數
    MOV R3,#1            ; 紀錄目前顯示的字
START:
    ACALL DELAY
    ACALL DELAY
    AJMP START
SHAKE:
    MOV R2,#0            ; 將R2歸0,重新計算
    INC R3               ; 將R3+1以顯示下一個數字
LED_SHOW:
    CLR C
    MOV A,R2
    SUBB A,#2
    JZ SHAKE             ; 若已經搖了2次,則跳到SHAKE
    MOV R1,#24           ; 字的寬度為24列的data
    MOV R0,#72           ; R0每次傳8bit的data,但全部有24*24筆data
                         ; 所以要傳24*24/8=72次

ONE:                     ; 顯示第1個數字
    CJNE R3,#1,TWO       ; 檢查是不是顯示第1個數字
    MOV DPTR,#TABLE1
    JMP NEXT_COLUMN
TWO:                     ; 顯示第2個數字
    CJNE R3,#2,THREE     ; 檢查是不是顯示第2個數字
    MOV DPTR,#TABLE2
    JMP NEXT_COLUMN
THREE:                   ; 顯示第3個數字
    CJNE R3,#3,FOUR      ; 檢查是不是顯示第3個數字
    MOV DPTR,#TABLE3
    JMP NEXT_COLUMN
FOUR:                    ; 顯示第4個數字
    CJNE R3,#4,FIVE      ; 檢查是不是顯示第4個數字
    MOV DPTR,#TABLE4
    JMP NEXT_COLUMN
FIVE:                    ; 顯示第5個數字
    CJNE R3,#5,SIX       ; 檢查是不是顯示第5個數字
    MOV DPTR,#TABLE5
    JMP NEXT_COLUMN
SIX:                     ; 顯示第6個數字
    CJNE R3,#6,SEVEN     ; 檢查是不是顯示第6個數字
    MOV DPTR,#TABLE6
    JMP NEXT_COLUMN
SEVEN:                   ; 顯示第7個數字
    MOV DPTR,#TABLE7
    MOV R3,#1            ; 將R3設為1以重複顯示
    JMP NEXT_COLUMN
NEXT_COLUMN:
    CALL  READ_BYTE      ; 取得data
    MOV  P0,A            ; 傳給P0(上面8個LED)
    CALL  READ_BYTE      ; 取得data
    MOV  P2,A            ; 傳給P0(上面8個LED)
    CALL  READ_BYTE      ; 取得data
    MOV  P1,A            ; 傳給P0(上面8個LED)
    CALL  DELAY          ; 暫停,以免顯示太快
    DJNZ  R1,NEXT_COLUMN ; 共有24個column的data要傳
    RET
READ_BYTE:
    DEC R0               ; 先將R0減1以讀取下一筆資料
    MOV  A,R0
    MOVC A,@A+DPTR       ; 取得的資料存在A
    CPL  A               ; 反轉A,輸出0則LED亮,輸出1則LED不亮
    RET
INTERRUPT:               ; 若晃動搖搖棒
    INC R2               ; 晃動次數+1
    CALL LED_SHOW        ; 搖搖棒顯示數字
    RETI
DELAY:
    MOV R5,#1
DELAY1:
    MOV R6,#255
DELAY2:
    MOV R7,#50
DELAY3:
    DJNZ R7,DELAY3
    DJNZ R6,DELAY2
    DJNZ R5,DELAY1
    RET
TABLE1:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,11111111B,11000000B
    DB      0000111B,11111111B,11111000B
    DB      0001111B,11111111B,11111100B
    DB      0001111B,10000000B,01111100B
    DB      0001100B,00000000B,00001100B
    DB      0011000B,00000000B,00001100B
    DB      0001111B,00000000B,00111100B
    DB      0001111B,11111111B,11111100B
    DB      0000111B,11111111B,11111000B
    DB      0000001B,11111111B,11100000B
    DB      0000000B,00000000B,00000000B
TABLE2:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00001100B
    DB      0000000B,00000000B,00111100B
    DB      0000000B,00000000B,01111100B
    DB      0000000B,00000011B,11101100B
    DB      0001111B,11111111B,11001100B
    DB      0001111B,11111110B,00001100B
    DB      0001111B,11111000B,00001100B
    DB      0000111B,00000000B,00001100B
    DB      0000000B,00000000B,00011100B
    DB      0000000B,00000000B,01111100B
    DB      0000000B,00000000B,01111100B
    DB      0000000B,00000000B,00000000B
TABLE3:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0001000B,00000000B,00000000B
    DB      0001000B,00000000B,00000000B
    DB      0001111B,11111111B,11111100B
    DB      0001111B,11111111B,11111100B
    DB      0001111B,11111111B,11111000B
    DB      0001000B,00000000B,00011000B
    DB      0001000B,00000000B,00011000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
TABLE4:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,11111111B,11000000B
    DB      0000111B,11111111B,11111000B
    DB      0001111B,11111111B,11111100B
    DB      0001111B,10000000B,01111100B
    DB      0001100B,00000000B,00001100B
    DB      0011000B,00000000B,00001100B
    DB      0001111B,00000000B,00111100B
    DB      0001111B,11111111B,11111100B
    DB      0000111B,11111111B,11111000B
    DB      0000001B,11111111B,11100000B
    DB      0000000B,00000000B,00000000B
TABLE5:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00001100B
    DB      0000000B,00000000B,00111100B
    DB      0000000B,00000000B,01111100B
    DB      0000000B,00000011B,11101100B
    DB      0001111B,11111111B,11001100B
    DB      0001111B,11111110B,00001100B
    DB      0001111B,11111000B,00001100B
    DB      0000111B,00000000B,00001100B
    DB      0000000B,00000000B,00011100B
    DB      0000000B,00000000B,01111100B
    DB      0000000B,00000000B,01111100B
    DB      0000000B,00000000B,00000000B
TABLE6:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000011B,11110000B,11110000B
    DB      0000111B,11111011B,11111000B
    DB      0001111B,11111111B,11111100B
    DB      0001100B,00001111B,10011100B
    DB      0011000B,00001110B,00001100B
    DB      0011000B,00000100B,00000100B
    DB      0001100B,10000100B,01001100B
    DB      0001111B,11000000B,11111100B
    DB      0001111B,11000000B,11111000B
    DB      0000011B,11000000B,01110000B
    DB      0000000B,00000000B,00000000B
TABLE7:
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0000000B,00000000B,00000000B
    DB      0001000B,10000000B,00000000B
    DB      0001000B,11000000B,00000000B
    DB      0001000B,11000000B,00000000B
    DB      0001111B,11111111B,11111100B
    DB      0001111B,11111111B,11111100B
    DB      0001111B,11111111B,11111000B
    DB      0001000B,11000011B,11100000B
    DB      0001000B,11000111B,10000000B
    DB      0000000B,11011111B,00000000B
    DB      0000000B,11111100B,00000000B
    DB      0000000B,11110000B,00000000B
    DB      0000000B,11000000B,00000000B
END